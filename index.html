  <!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Launcher Futurista ‚Äì Rastreamento</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff8a00">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body {
      margin: 0;
      background: #0b0d0f;
      color: #00ffe1;
      font-family: Arial, Helvetica, sans-serif;
    }

    #map {
      height: 55vh;
      width: 100%;
    }

    #controls {
      display: flex;
      gap: 10px;
      padding: 10px;
      flex-wrap: wrap;
    }

    #controls button, #controls select {
      background: #0b0d0f;
      color: #00ffe1;
      border: 1px solid #00ffe1;
      padding: 10px 14px;
      border-radius: 10px;
      font-size: 14px;
    }

    #hud {
      margin: 10px;
      padding: 12px;
      backdrop-filter: blur(10px);
      background: rgba(0,0,0,0.55);
      border: 1px solid #00ffe1;
      border-radius: 14px;
      font-family: monospace;
    }

    #privacy {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      color: #00ffe1;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    #privacy div {
      max-width: 400px;
      padding: 20px;
      border: 1px solid #00ffe1;
      border-radius: 12px;
      text-align: center;
      background: #0b0d0f;
    }

    #privacy button {
      margin-top: 15px;
      padding: 10px 16px;
      background: #00ffe1;
      border: none;
      color: #000;
      border-radius: 8px;
      font-weight: bold;
    }
  </style>
</head>

<body>

  <!-- AVISO DE PRIVACIDADE -->
  <div id="privacy">
    <div>
      <h3>Uso de Localiza√ß√£o</h3>
      <p>Este aplicativo utiliza sua localiza√ß√£o apenas para rastreamento em tempo real. Nenhuma informa√ß√£o √© compartilhada.</p>
      <button onclick="aceitarPrivacidade()">Aceitar</button>
    </div>
  </div>

  <!-- MAPA -->
  <div id="map"></div>

  <!-- CONTROLES -->
  <div id="controls">
    <button onclick="iniciarRastreamentoReal()">‚ñ∂ Iniciar</button>
    <button onclick="pararRastreamento()">‚èπ Parar</button>

    <select id="modoGPS">
      <option value="alta">Alta precis√£o</option>
      <option value="economia">Economia</option>
    </select>
  </div>

  <!-- HUD -->
  <div id="hud">
    <p>Latitude: <span id="lat">--</span></p>
    <p>Longitude: <span id="lon">--</span></p>
    <p>Precis√£o: <span id="acc">--</span> m</p>
    <p>Atualizado: <span id="time">--</span></p>
    <hr>
    <p>üìû Consulta por DDD</p>
    <input id="phoneInput" placeholder="DDD + n√∫mero" style="width:100%;margin-top:6px">
    <button onclick="consultarNumero()" style="margin-top:6px">Consultar</button>
    <p id="dddResult" style="margin-top:6px"></p>
  </div>

  <!-- SCRIPT PRINCIPAL -->
  <script>
    // SERVICE WORKER
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js");
    }

    // PRIVACIDADE
    const privacyBox = document.getElementById("privacy");
    if (localStorage.getItem("privacyAccepted")) {
      privacyBox.style.display = "none";
    }

    function aceitarPrivacidade() {
      localStorage.setItem("privacyAccepted", true);
      privacyBox.style.display = "none";
    }

    // MAPA
    const map = L.map("map").setView([-14.24, -51.92], 4);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "¬© OpenStreetMap"
    }).addTo(map);

    let watchId = null;
    let marker = null;

    // HUD ELEMENTOS
    const latEl = document.getElementById("lat");
    const lonEl = document.getElementById("lon");
    const accEl = document.getElementById("acc");
    const timeEl = document.getElementById("time");

    // RESTAURA √öLTIMA LOCALIZA√á√ÉO
    const ultima = JSON.parse(localStorage.getItem("ultimaLocalizacao"));
    if (ultima) {
      map.setView([ultima.lat, ultima.lon], 15);
    }

    function iniciarRastreamentoReal() {
      if (!navigator.geolocation) {
        alert("Geolocaliza√ß√£o n√£o suportada");
        return;
      }

      const modo = document.getElementById("modoGPS").value;

      const options = {
        enableHighAccuracy: modo === "alta",
        timeout: 10000,
        maximumAge: modo === "economia" ? 60000 : 0
      };

      watchId = navigator.geolocation.watchPosition(
        (pos) => {
          const { latitude, longitude, accuracy } = pos.coords;

          if (marker) map.removeLayer(marker);

          marker = L.marker([latitude, longitude])
            .addTo(map)
            .bindPopup(`üìç Voc√™ est√° aqui<br>Precis√£o: ${Math.round(accuracy)}m`)
            .openPopup();

          map.setView([latitude, longitude], 17);

          latEl.textContent = latitude.toFixed(6);
          lonEl.textContent = longitude.toFixed(6);
          accEl.textContent = Math.round(accuracy);
          timeEl.textContent = new Date().toLocaleTimeString();

          localStorage.setItem(
            "ultimaLocalizacao",
            JSON.stringify({ lat: latitude, lon: longitude, acc: accuracy })
          );
        },
        (err) => alert("Erro ao obter localiza√ß√£o: " + err.message),
        options
      );
    }

    function pararRastreamento() {
      if (watchId !== null) {
        navigator.geolocation.clearWatch(watchId);
        watchId = null;
        alert("Rastreamento pausado");
      }
    }
  </script>
<script>
/* ===== RASTREAMENTO POR N√öMERO (DDD ‚Üí MAPA) ===== */
function consultarNumero() {
  const input = document.getElementById("phoneInput");
  const resultado = document.getElementById("dddResult");

  if (!input) return;

  const numero = input.value.replace(/\D/g, "");
  if (numero.length < 2) {
    resultado.textContent = "Digite pelo menos o DDD";
    return;
  }

  const ddd = numero.substring(0, 2);

  const mapaDDD = {
    "11": { estado: "S√£o Paulo", lat: -23.55, lon: -46.63 },
    "21": { estado: "Rio de Janeiro", lat: -22.90, lon: -43.17 },
    "31": { estado: "Minas Gerais", lat: -19.92, lon: -43.94 },
    "41": { estado: "Paran√°", lat: -25.43, lon: -49.27 },
    "51": { estado: "Rio Grande do Sul", lat: -30.03, lon: -51.23 },
    "61": { estado: "Distrito Federal", lat: -15.79, lon: -47.88 },
    "81": { estado: "Pernambuco", lat: -8.05, lon: -34.90 },
    "85": { estado: "Cear√°", lat: -3.73, lon: -38.52 },
    "91": { estado: "Par√°", lat: -1.45, lon: -48.50 }
  };

  if (!mapaDDD[ddd]) {
    resultado.textContent = "DDD n√£o reconhecido";
    return;
  }

  const dados = mapaDDD[ddd];

  // Remove marcador do GPS (se existir)
  if (marker) map.removeLayer(marker);

  // Marca a regi√£o do n√∫mero
  marker = L.marker([dados.lat, dados.lon])
    .addTo(map)
    .bindPopup(
      `üìû N√∫mero localizado (aprox.)<br>
       <strong>${dados.estado}</strong><br>
       DDD ${ddd}`
    )
    .openPopup();

  map.setView([dados.lat, dados.lon], 9);

  resultado.innerHTML = `üìû ${dados.estado} ‚Äî DDD ${ddd}<br><small>Localiza√ß√£o aproximada</small>`;
}
</script>



<!-- ===== IN√çCIO: Sele√ß√£o de Pa√≠s / Estados (Brasil e Exterior) ===== -->
<div class="localizacao-box" style="margin-top:20px;">
  <h3>üìç Localiza√ß√£o</h3>

  <label for="pais">Pa√≠s:</label>
  <select id="pais" onchange="atualizarEstados()">
    <option value="">Selecione o pa√≠s</option>
    <option value="BR">Brasil</option>
    <option value="US">Estados Unidos</option>
    <option value="PT">Portugal</option>
    <option value="AR">Argentina</option>
    <option value="FR">Fran√ßa</option>
    <option value="DE">Alemanha</option>
    <option value="JP">Jap√£o</option>
    <option value="OUTRO">Outro</option>
  </select>

  <label for="estado">Estado / Regi√£o:</label>
  <select id="estado">
    <option value="">Selecione</option>
  </select>
</div>
<!-- ===== FIM: Sele√ß√£o de Pa√≠s / Estados ===== -->

<script>
// ===== IN√çCIO: Dados de Estados e Regi√µes =====
const estadosBrasil = [
  "Acre", "Alagoas", "Amap√°", "Amazonas", "Bahia", "Cear√°",
  "Distrito Federal", "Esp√≠rito Santo", "Goi√°s", "Maranh√£o",
  "Mato Grosso", "Mato Grosso do Sul", "Minas Gerais",
  "Par√°", "Para√≠ba", "Paran√°", "Pernambuco", "Piau√≠",
  "Rio de Janeiro", "Rio Grande do Norte", "Rio Grande do Sul",
  "Rond√¥nia", "Roraima", "Santa Catarina", "S√£o Paulo",
  "Sergipe", "Tocantins"
];

const regioesExterior = {
  US: ["Calif√≥rnia", "Texas", "Fl√≥rida", "Nova York"],
  PT: ["Lisboa", "Porto", "Braga", "Coimbra"],
  AR: ["Buenos Aires", "C√≥rdoba", "Ros√°rio"],
  FR: ["√éle-de-France", "Occit√¢nia", "Proven√ßa"],
  DE: ["Berlim", "Baviera", "Hamburgo"],
  JP: ["T√≥quio", "Osaka", "Quioto"]
};

function atualizarEstados() {
  const pais = document.getElementById("pais").value;
  const estadoSelect = document.getElementById("estado");

  estadoSelect.innerHTML = "<option value=''>Selecione</option>";

  if (pais === "BR") {
    estadosBrasil.forEach(estado => {
      const opt = document.createElement("option");
      opt.value = estado;
      opt.textContent = estado;
      estadoSelect.appendChild(opt);
    });
  } else if (regioesExterior[pais]) {
    regioesExterior[pais].forEach(regiao => {
      const opt = document.createElement("option");
      opt.value = regiao;
      opt.textContent = regiao;
      estadoSelect.appendChild(opt);
    });
  }
}
// ===== FIM: Dados de Estados e Regi√µes =====

// ===== IN√çCIO: Integra√ß√£o Pa√≠s + Estado + DDD + GPS =====
const dddPorEstado = {
  "S√£o Paulo": "11‚Äì19",
  "Rio de Janeiro": "21‚Äì24",
  "Minas Gerais": "31‚Äì38",
  "Bahia": "71‚Äì77",
  "Paran√°": "41‚Äì46",
  "Rio Grande do Sul": "51‚Äì55",
  "Santa Catarina": "47‚Äì49",
  "Distrito Federal": "61",
  "Goi√°s": "62‚Äì64",
  "Pernambuco": "81‚Äì89",
  "Cear√°": "85‚Äì88",
  "Par√°": "91‚Äì94",
  "Amazonas": "92‚Äì97"
};

function mostrarDDD() {
  const estado = document.getElementById("estado").value;
  let info = document.getElementById("infoDDD");

  if (!info) {
    info = document.createElement("div");
    info.id = "infoDDD";
    document.querySelector(".localizacao-box").appendChild(info);
  }

  if (dddPorEstado[estado]) {
    info.innerHTML = `üìû DDD do estado: <strong>${dddPorEstado[estado]}</strong>`;
  } else if (estado) {
    info.innerHTML = "üìû DDD n√£o dispon√≠vel para esta regi√£o";
  }
}

const estadoSelect = document.getElementById("estado");
if (estadoSelect) {
  estadoSelect.addEventListener("change", mostrarDDD);
}

// ===== INTEGRA√á√ÉO COM GPS =====
function detectarPaisPorGPS(lat, lon) {
  if (lat < -33 && lat > -5 && lon < -34 && lon > -74) {
    document.getElementById("pais").value = "BR";
    atualizarEstados();
  }
}

if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(pos => {
    detectarPaisPorGPS(pos.coords.latitude, pos.coords.longitude);
  });
}
// ===== FIM: Integra√ß√µes =====
</script>

</body>
</html>
